{"version":3,"sources":["page-preloader.js"],"names":["global","factory","exports","module","define","amd","supportedExtensions","image","audio","video","supportedTags","other","allSupportedTags","Set","Object","values","reduce","a","b","concat","base64head","Resource","item","isElement","element","HTMLElement","url","consistent","includes","tagName","toLowerCase","type","extension","RegExp","test","split","pop","x","y","length","format","extensions","join","matches","match","replace","LoaderPromise","fn","resolve","reject","value","_progress","forEach","listener","error","handler","push","Promise","find","document","body","options","settings","srcAttributes","src","lazy","srcset","sizesAttributes","sizes","media","backgrounds","collection","tagsSelector","srcAttributesValues","srcAttributesSelector","map","targets","querySelectorAll","filter","el","parentElement","target","source","attribute","i","j","getAttribute","window","getComputedStyle","getPropertyValue","switchAttributes","attrs","keys","attr","dataAttr","dataAttrVal","setAttribute","removeAttribute","copyAttributes","attributes","removeAttributes","isElementInViewport","ID","s4","Math","floor","random","toString","substring","threshold","num","segments","isIntersectionObserverSupported","LoaderEvent","CustomEvent","event","params","bubbles","cancelable","detail","undefined","evt","createEvent","initCustomEvent","prototype","Event","Loader","_options","playthrough","sequential","_collection","_queue","Map","_load","_percentage","_state","manuallyObservedElements","manuallyObserve","intersected","dispatchEvent","addEventListener","data","progress","loaded","pipeline","fetch","catch","payload","console","warn","message","resource","then","isConsistent","contains","hasSources","createdElement","createElement","mainEventsTarget","style","visibility","position","top","left","width","height","appendChild","createdSource","append","img","querySelector","createdImg","finishPromise","resolver","load","removeChild","delete","prepareLoad","eventName","queuer","observer","dispatchedEvent","e","IntersectionObserver","entries","entry","intersectionRatio","unobserve","root","rootMargin","observe","set","NodeList","isResource","Array","isArray","pushCheck","logEl","log","hasChildNodes","ol","list","li","innerHTML","scrollTop","offsetHeight","pageLoader","pageLoad","container","closest","percentage","classList","add","children","dataset","setTimeout"],"mappings":"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","file":"page-preloader.js","sourcesContent":["(function (global, factory) {\n    typeof exports === 'object' && typeof module !== 'undefined' ? factory() :\n    typeof define === 'function' && define.amd ? define('lazyloader', factory) :\n    (factory());\n}(this, (function () { 'use strict';\n\n    const supportedExtensions = {\n        image: ['jp[e]?g', 'jpe', 'jif', 'jfif', 'jfi', 'gif', 'png', 'tif[f]?', 'bmp', 'dib', 'webp', 'ico', 'cur', 'svg'],\n        audio: ['mp3', 'ogg', 'oga', 'spx', 'ogg', 'wav'],\n        video: ['mp4', 'ogg', 'ogv', 'webm']\n    };\n    const supportedTags = {\n        image: ['img', 'picture'],\n        audio: ['audio'],\n        video: ['video'],\n        other: ['iframe'] // TODO: ...\n    };\n    const allSupportedTags = [...new Set(Object.values(supportedTags).reduce((a, b) => a.concat(b)))];\n\n    const base64head = ';base64,';\n\n    /**\n     * @param {Object} item\n     * @returns {Object}\n     */\n    class Resource {\n        constructor(item) {\n            const isElement = item.element instanceof HTMLElement;\n\n            this.url = item.url;\n            this.consistent = isElement && allSupportedTags.includes(item.element.tagName.toLowerCase());\n            this.element = isElement ? item.element : null;\n            const tagName = isElement ? this.element.tagName.toLowerCase() : null;\n            this.type = null;\n            this.extension = null;\n\n            if (!this.url) {\n                return;\n            }\n\n            this.url = item.url;\n\n            // this cleans urls like \"url.jpg, url.jpg x2\" ...\n            if (!new RegExp(`${base64head}`).test(this.url)) {\n                this.url = this.url\n                    .split(',')\n                    .pop() // gets the last\n                    .split(' ')\n                    .reduce((x, y) => (x.length > y.length ? x : y)); // gets the longest fragment in order to skip \"x2\", \"\" etc...\n            }\n\n            for (let format in supportedExtensions) {\n                const extensions = supportedExtensions[format].join('|');\n\n                if (new RegExp(`(.(${extensions})$)|data:${format}/(${extensions})${base64head}`).test(this.url)) {\n                    const matches = this.url.match(new RegExp(`.(${extensions})$`, 'g')) || this.url.match(new RegExp(`^data:${format}/(${extensions})`, 'g'));\n\n                    if (null !== matches) {\n                        this.type = format;\n                        this.extension = matches[0].replace(`data:${format}/`, '').replace('.', '');\n\n                        break;\n                    }\n                }\n            }\n\n            if (this.consistent && (tagName === 'audio' || tagName === 'video' || tagName === 'iframe')) {\n                this.type = tagName;\n            } else if (tagName) {\n                for (let format in supportedTags) {\n                    if (supportedTags[format].includes(tagName)) {\n                        this.type = format;\n                        break;\n                    }\n                }\n            }\n        }\n\n        static isResource(item) {\n            return typeof item === 'object' && 'type' in item && 'url' in item && 'extension' in item && 'element' in item;\n        }\n    }\n\n    /**\n     *\n     */\n    class LoaderPromise extends Promise {\n        constructor(fn) {\n            super((resolve, reject) => {\n                fn(resolve, reject, value => {\n                    try {\n                        return this._progress.forEach(listener => listener(value));\n                    } catch (error) {\n                        reject(error);\n                    }\n                });\n            });\n\n            this._progress = [];\n        }\n\n        progress(handler) {\n            if (typeof handler === 'function') {\n                this._progress.push(handler);\n            }\n\n            return this;\n        }\n    }\n\n    /**\n     *\n     * @param {HTMLElement} [element=document.body]\n     * @param {Object} [options={ srcAttr: 'src', srcsetAttr: 'srcset', backgrounds: false }]\n     * @returns {Array}\n     */\n    const find = (element = document.body, options = {}) => {\n        let settings = {\n            ...{\n                srcAttributes: {\n                    src: !!!options.lazy ? 'src' : 'data-src',\n                    srcset: !!!options.lazy ? 'srcset' : 'data-srcset'\n                },\n                sizesAttributes: {\n                    sizes: !!!options.lazy ? 'sizes' : 'data-sizes',\n                    media: !!!options.lazy ? 'media' : 'data-media'\n                },\n                backgrounds: false\n            },\n            ...options\n        };\n\n        let collection = [];\n\n        const tagsSelector = allSupportedTags.join(',');\n        const srcAttributesValues = Object.values(settings.srcAttributes);\n        const srcAttributesSelector = srcAttributesValues.map(x => `[${x}]`).join(',');\n\n        let targets = [...element.querySelectorAll(tagsSelector)].filter(el => !el.parentElement || el.parentElement.tagName.toLowerCase() !== 'picture');\n        if (element.matches(tagsSelector) && (!element.parentElement || element.parentElement.tagName.toLowerCase() !== 'picture')) {\n            targets.push(element);\n        }\n\n        targets.forEach(target => {\n            let source = target;\n\n            if (target.querySelectorAll('source').length) {\n                source = target.querySelectorAll('source');\n                source = [...source][0];\n            }\n\n            if (source.matches(srcAttributesSelector)) {\n                let attribute = '';\n\n                for (let i = 0, j = srcAttributesValues.length; i < j; i++) {\n                    attribute = source.getAttribute(srcAttributesValues[i]);\n                    if (attribute) {\n                        break;\n                    }\n                }\n\n                collection.push(\n                    new Resource({\n                        element: target,\n                        url: attribute\n                    })\n                );\n            }\n        });\n\n        if (true === settings.backgrounds) {\n            targets = [...element.querySelectorAll('*')];\n            targets.push(element);\n            targets = targets.filter(target => !target.matches(tagsSelector));\n            targets = targets.filter(target => window.getComputedStyle(target).getPropertyValue('background-image') !== 'none');\n            targets.forEach(target => {\n                const url = window.getComputedStyle(target).getPropertyValue('background-image').match(/\\((.*?)\\)/);\n\n                if (null !== url && url.length >= 2) {\n                    collection.push(\n                        new Resource({\n                            element: target,\n                            url: url[1].replace(/('|\")/g, '')\n                        })\n                    );\n                }\n            });\n        }\n\n        return collection;\n    };\n\n    /**\n     *\n     * @param {HTMLElement} el\n     * @param {Object} attrs\n     * @returns {void}\n     */\n    const switchAttributes = (el, attrs) => {\n        Object.keys(attrs).forEach(attr => {\n            let dataAttr = attrs[attr];\n            dataAttr = dataAttr === 'src' || dataAttr === 'srcset' ? `data-${dataAttr}` : dataAttr; // TODO: refactory\n            const dataAttrVal = el.getAttribute(dataAttr);\n\n            if (dataAttrVal) {\n                el.setAttribute(attr, dataAttrVal);\n                el.removeAttribute(dataAttr);\n            }\n        });\n    };\n\n    /**\n     *\n     * @param {HTMLElement} el\n     * @param {HTMLElement} attributes\n     * @returns {void}\n     */\n    const copyAttributes = (el, target, attributes) =>\n        attributes.forEach(attr => {\n            const attribute = target.getAttribute(attr);\n            if (attribute) {\n                el.setAttribute(attr === 'src' || attr === 'srcset' ? `data-${attr}` : attr, attribute); // TODO: refactory\n            }\n        });\n\n    /**\n     *\n     * @param {HTMLElement} el\n     * @param {Array} attributes\n     * @returns {void}\n     */\n    const removeAttributes = (el, attributes) => attributes.forEach(attr => el.removeAttribute(attr));\n\n    /**\n     * used in the IntersectionObserver fallback logic\n     * @param el\n     * returns {boolean}\n     */\n    const isElementInViewport = el => true;\n\n    // TODO: rename\n    const ID = (() => {\n        const s4 = () =>\n            Math.floor((1 + Math.random()) * 0x10000)\n                .toString(16)\n                .substring(1);\n        return `${s4()}${s4()}-${s4()}-${s4()}-${s4()}-${s4()}${s4()}${s4()}`;\n    })();\n\n    // TODO: rename\n    // TODO: consider exposing it in options maybe?\n    const threshold = (num => {\n        let segments = [];\n\n        for (let i = 0; i < num; i++) {\n            segments.push((2 * i) / 100);\n        }\n\n        return segments;\n    })(50);\n\n    const isIntersectionObserverSupported = 'IntersectionObserver' in window;\n\n    const LoaderEvent = (() => {\n        if (typeof window.CustomEvent === 'function') {\n            return window.CustomEvent;\n        }\n\n        function CustomEvent(event, params) {\n            params = params || {\n                bubbles: false,\n                cancelable: false,\n                detail: undefined\n            };\n\n            const evt = document.createEvent('CustomEvent');\n\n            evt.initCustomEvent(event, params.bubbles, params.cancelable, params.detail);\n\n            return evt;\n        }\n\n        CustomEvent.prototype = window.Event.prototype;\n\n        return CustomEvent;\n    })();\n\n    /**\n     *\n     * TODO: find a way to get a recap of what Resource items were loaded and what failed in collection list...\n     */\n    class Loader {\n        constructor(options = {}) {\n            this._options = {\n                ...{\n                    srcAttributes: {\n                        src: !!!options.lazy ? 'src' : 'data-src',\n                        srcset: !!!options.lazy ? 'srcset' : 'data-srcset'\n                    },\n                    sizesAttributes: {\n                        sizes: !!!options.lazy ? 'sizes' : 'data-sizes',\n                        media: !!!options.lazy ? 'media' : 'data-media'\n                    },\n                    lazy: false,\n                    playthrough: false,\n                    backgrounds: true,\n                    sequential: false\n                },\n                ...options\n            };\n\n            this._collection = []; // resources (array of type Resource)\n            this._queue = new Map(); // loading resources\n\n            this._load = null; // main load Promise\n\n            this._percentage = 0; // loading percentage\n            this._state = 0; // 0: inactive - 1: busy\n\n            if (!isIntersectionObserverSupported) {\n                this.manuallyObservedElements = [];\n\n                const manuallyObserve = () =>\n                    this.manuallyObservedElements\n                        .filter(item => !item.intersected)\n                        .forEach(item => {\n                            if (!item.intersected && isElementInViewport(item.element)) {\n                                item.intersected = true;\n                                item.element.dispatchEvent(new LoaderEvent(`intersected__${ID}`));\n                            }\n                        });\n\n                window.addEventListener('scroll', manuallyObserve);\n                window.addEventListener('resize', manuallyObserve);\n                window.addEventListener('load', manuallyObserve);\n            }\n        }\n\n        /**\n         * @returns {Number} percentage\n         */\n        get percentage() {\n            return this._percentage;\n        }\n\n        /**\n         * @param {(Array|HTMLElement)} collection\n         */\n        set collection(collection) {\n            if (this._state === 0) {\n                if (collection instanceof NodeList) {\n                    collection = [...collection];\n                }\n\n                if (collection instanceof HTMLElement) {\n                    collection = find(collection, this._options);\n                }\n\n                if (typeof collection === 'string') {\n                    collection = [new Resource({ url: collection })];\n                }\n\n                if (Resource.isResource(collection)) {\n                    collection = [collection];\n                }\n\n                if (Array.isArray(collection)) {\n                    this._collection = [];\n\n                    collection.forEach(item => {\n                        const pushCheck = resource => {\n                            if (resource.type === 'image' || resource.type === 'video' || resource.type === 'audio' || (resource.type === 'iframe' && resource.consistent)) {\n                                this._collection.push(resource);\n\n                                return;\n                            }\n\n                            console.warn(\"Couldn't add resource to collection\", resource);\n                        };\n\n                        if (item instanceof HTMLElement) {\n                            find(item, this._options).forEach(resource => pushCheck(new Resource(resource)));\n                        }\n\n                        if (typeof item === 'string') {\n                            pushCheck(new Resource({ url: item }));\n                        }\n\n                        if (Resource.isResource(item)) {\n                            pushCheck(item);\n                        }\n                    });\n                }\n            }\n        }\n\n        /**\n         *\n         * @returns {Array} collection\n         */\n        get collection() {\n            return this._collection;\n        }\n\n        /**\n         *\n         * @returns {void}\n         */\n        abort() {\n            if (this._state === 0) {\n                return;\n            }\n\n            this._state = 0;\n\n            this._queue.forEach((data, element) => element.dispatchEvent(new LoaderEvent(`abort__${ID}`)));\n        }\n\n        /**\n         *\n         * @returns {Promise}\n         */\n        load() {\n            this._load = new LoaderPromise((resolve, reject, progress) => {\n                if (this._state === 1) {\n                    reject('This Loader instance is already in progress');\n                }\n\n                if (!this._collection.length) {\n                    reject('Resources collection is empty');\n                }\n\n                this._state = 1;\n\n                if (this._options.sequential) {\n                    let loaded = 0;\n                    const pipeline = () => {\n                        if (this._state === 0) {\n                            reject('Loader instance aborted');\n\n                            this._collection = [];\n\n                            return;\n                        }\n\n                        this.fetch(this._collection[loaded])\n                            .catch(payload => {\n                                console.warn(`${payload.event.detail.message}: ${payload.resource.url}`);\n\n                                return payload;\n                            })\n                            .then(payload => {\n                                if (this._state !== 0) {\n                                    loaded++;\n                                }\n\n                                this._percentage = (loaded / this._collection.length) * 100;\n\n                                // TODO: a more robust way to skip progress call in a then from a catch, possibly inside LoaderPromise?\n                                if (this._state !== 0) {\n                                    progress(payload);\n                                }\n\n                                if (loaded < this._collection.length) {\n                                    pipeline();\n\n                                    return;\n                                }\n\n                                this._state = 0;\n\n                                resolve(payload);\n                            });\n                    };\n\n                    pipeline();\n                } else {\n                    let loaded = 0;\n\n                    for (let i = 0; i < this._collection.length; i++) {\n                        if (this._state === 0) {\n                            reject('Loader instance aborted');\n\n                            this._collection = [];\n\n                            break;\n                        }\n\n                        this.fetch(this._collection[i])\n                            .catch(payload => {\n                                console.warn(`${payload.event.detail.message}: ${payload.resource.url}`);\n\n                                return payload;\n                            })\n                            .then(payload => {\n                                if (this._state !== 0) {\n                                    loaded++;\n                                }\n\n                                this._percentage = (loaded / this._collection.length) * 100;\n\n                                // TODO: a more robust way to skip progress call in a then from a catch, possibly inside LoaderPromise?\n                                if (this._state !== 0) {\n                                    progress(payload);\n                                }\n\n                                if (loaded >= this._collection.length) {\n                                    this._state = 0;\n\n                                    resolve();\n                                }\n                            });\n                    }\n                }\n            });\n\n            return this._load;\n        }\n\n        /**\n         *\n         * @param {Resource} resource\n         * @returns {Promise}\n         */\n        fetch(resource) {\n            return new Promise((resolve, reject) => {\n                const isConsistent = resource.consistent && document.body.contains(resource.element);\n                const hasSources = isConsistent && resource.element.querySelectorAll('source').length;\n                const tagName = isConsistent ? resource.element.tagName.toLowerCase() : supportedTags[resource.type][0];\n                const createdElement = document.createElement(tagName);\n\n                let mainEventsTarget = createdElement;\n\n                if (resource.type === 'iframe') {\n                    createdElement.style.visibility = 'hidden';\n                    createdElement.style.position = 'fixed';\n                    createdElement.style.top = '-999px';\n                    createdElement.style.left = '-999px';\n                    createdElement.style.width = '1px';\n                    createdElement.style.height = '1px';\n                    document.body.appendChild(createdElement);\n                }\n\n                if (isConsistent) {\n                    copyAttributes(createdElement, resource.element, Object.values(this._options.srcAttributes));\n                    copyAttributes(createdElement, resource.element, Object.values(this._options.sizesAttributes));\n\n                    if (hasSources) {\n                        [...resource.element.querySelectorAll('source')].forEach(source => {\n                            const createdSource = document.createElement('source');\n                            copyAttributes(createdSource, source, Object.values(this._options.srcAttributes));\n                            copyAttributes(createdSource, source, Object.values(this._options.sizesAttributes));\n                            createdElement.append(createdSource);\n                        });\n                    }\n\n                    if (tagName === 'picture') {\n                        // picture elements event listeners need to be attached to inner img elements\n                        const img = resource.element.querySelector('img');\n                        const createdImg = document.createElement('img');\n                        copyAttributes(createdImg, img, Object.values(this._options.srcAttributes));\n                        copyAttributes(createdImg, img, Object.values(this._options.sizesAttributes));\n                        createdElement.append(createdImg);\n                        mainEventsTarget = createdImg;\n                    }\n                }\n\n                const finishPromise = (event, resolver) => {\n                    if (isConsistent) {\n                        switchAttributes(resource.element, this._options.srcAttributes);\n                        switchAttributes(resource.element, this._options.sizesAttributes);\n\n                        if (hasSources) {\n                            [...resource.element.querySelectorAll('source')].forEach(source => {\n                                switchAttributes(source, this._options.srcAttributes);\n                                switchAttributes(source, this._options.sizesAttributes);\n                            });\n                        }\n\n                        if (resource.type === 'video' || resource.type === 'audio') {\n                            resource.element.load();\n                        }\n\n                        if (resource.type === 'iframe') {\n                            createdElement.parentElement.removeChild(createdElement);\n                        }\n                    }\n\n                    this._queue.delete(createdElement);\n\n                    resolver({\n                        event: event,\n                        resource: resource\n                    });\n                };\n\n                const prepareLoad = () => {\n                    if (isConsistent) {\n                        switchAttributes(createdElement, this._options.srcAttributes);\n                        switchAttributes(createdElement, this._options.sizesAttributes);\n\n                        if (hasSources) {\n                            [...createdElement.querySelectorAll('source')].forEach(source => {\n                                switchAttributes(source, this._options.srcAttributes);\n                                switchAttributes(source, this._options.sizesAttributes);\n                            });\n                        }\n                    } else {\n                        createdElement.setAttribute('src', resource.url);\n                    }\n\n                    if (resource.type === 'video' || resource.type === 'audio') {\n                        createdElement.load();\n                    }\n                };\n\n                const dispatchEvent = (eventName = '', data = {}) => {\n                    const event = new LoaderEvent(eventName, {\n                        detail: {\n                            ...data,\n                            ...{\n                                resource: resource\n                            }\n                        }\n                    });\n\n                    if (resource.element) {\n                        resource.element.dispatchEvent(event);\n                    }\n\n                    document.dispatchEvent(event);\n\n                    return event;\n                };\n\n                let queuer = {\n                    resource: resource,\n                    observer: null,\n                    element: createdElement\n                };\n\n                createdElement.addEventListener(`abort__${ID}`, () => {\n                    removeAttributes(createdElement, Object.keys(this._options.srcAttributes));\n                    removeAttributes(createdElement, Object.values(this._options.srcAttributes));\n                    removeAttributes(createdElement, Object.keys(this._options.sizesAttributes));\n                    removeAttributes(createdElement, Object.values(this._options.sizesAttributes));\n\n                    if (hasSources) {\n                        [...createdElement.querySelectorAll('source')].forEach(source => {\n                            removeAttributes(source, Object.keys(this._options.srcAttributes));\n                            removeAttributes(source, Object.values(this._options.srcAttributes));\n                            removeAttributes(source, Object.keys(this._options.sizesAttributes));\n                            removeAttributes(source, Object.values(this._options.sizesAttributes));\n                        });\n                    }\n\n                    const dispatchedEvent = dispatchEvent('resourceError', { type: 'abortion', message: 'Resource load aborted' });\n\n                    finishPromise(dispatchedEvent, reject);\n                });\n\n                mainEventsTarget.addEventListener('error', e => {\n                    const dispatchedEvent = dispatchEvent('resourceError', {\n                        type: e.type,\n                        message: 'Resource failed to load' // TODO: a way to retrieve http error code ?\n                    });\n\n                    finishPromise(dispatchedEvent, reject);\n                });\n\n                if (resource.type === 'image' || resource.type === 'iframe') {\n                    mainEventsTarget.addEventListener('load', e => {\n                        if (e.target.tagName.toLowerCase() === 'iframe' && !e.target.getAttribute('src')) {\n                            return; // iframes fire \"load\" event when ready in dom\n                        }\n\n                        const dispatchedEvent = dispatchEvent('resourceLoad', {\n                            type: e.type\n                        });\n\n                        finishPromise(dispatchedEvent, resolve);\n                    });\n                }\n\n                if (resource.type === 'audio' || resource.type === 'video') {\n                    mainEventsTarget.addEventListener(this._options.playthrough ? 'canplaythrough' : 'loadedmetadata', e => {\n                        const dispatchedEvent = dispatchEvent('resourceLoad', {\n                            type: e.type\n                        });\n\n                        finishPromise(dispatchedEvent, resolve);\n                    });\n                }\n\n                if (resource.element instanceof HTMLElement && this._options.lazy) {\n                    if (isIntersectionObserverSupported) {\n                        queuer.observer = new IntersectionObserver(\n                            (entries, observer) => {\n                                entries.forEach(entry => {\n                                    if (entry.intersectionRatio > 0) {\n                                        observer.unobserve(entry.target);\n\n                                        prepareLoad();\n                                    }\n                                });\n                            },\n                            {\n                                root: null,\n                                rootMargin: '0px',\n                                threshold: threshold\n                            }\n                        );\n\n                        queuer.observer.observe(resource.element);\n                    } else {\n                        if (isElementInViewport(resource.element)) {\n                            prepareLoad();\n                        } else {\n                            this.manuallyObservedElements.push({\n                                element: resource.element,\n                                intersected: false\n                            });\n\n                            resource.element.addEventListener(`intersected__${ID}`, () => prepareLoad());\n                        }\n                    }\n\n                    this._queue.set(resource.element, queuer);\n                } else {\n                    this._queue.set(createdElement, queuer);\n\n                    prepareLoad();\n                }\n            });\n        }\n    }\n\n    const logEl = document.querySelector('#console');\n    const log = (...message) => {\n        console.log(...message);\n\n        if (!logEl.hasChildNodes()) {\n            const ol = document.createElement('ol');\n            logEl.append(ol);\n        }\n\n        const list = logEl.querySelector('ol');\n        const li = document.createElement('li');\n        li.innerHTML = message;\n        list.append(li);\n\n        logEl.scrollTop = list.offsetHeight;\n    };\n\n    const pageLoader = new Loader({\n        playthrough: true,\n        backgrounds: true,\n        sequential: false\n    });\n\n    pageLoader.collection = document.querySelectorAll('.playground');\n\n    window.addEventListener(\n        'load',\n        () => {\n            const pageLoad = pageLoader.load();\n\n            pageLoad.progress(e => {\n                if (!e.resource.element) {\n                    return;\n                }\n\n                const container = e.resource.element.matches('.playground') ? e.resource.element : e.resource.element.closest('.playground');\n                const percentage = container.querySelector('.playground__percentage');\n                const item = e.resource.element.closest('.playground__item');\n\n                if (percentage) {\n                    percentage.classList.add('visible');\n                }\n\n                if (item) {\n                    e.resource.element.closest('.playground__item').classList.add('loaded');\n                }\n\n                if (percentage) {\n                    percentage.children[0].dataset.percentage =\n                        (container.querySelectorAll('.playground__item.loaded').length / container.querySelectorAll('.playground__item').length) * 100;\n                }\n\n                document.querySelector('#preloader').innerHTML = pageLoader.percentage + '%';\n\n                log('Total page load: ' + pageLoader.percentage + '% ' + e.resource.url);\n            });\n            pageLoad\n                .catch(error => log(error))\n                .then(() => {\n                    document.querySelector('#preloader').innerHTML = 'done!';\n                    setTimeout(() => document.body.classList.add('loaded'), 500);\n                    log('All done!');\n                });\n        },\n        false\n    );\n\n    document.querySelectorAll('img').forEach(img => img.addEventListener('resourceError', e => e.detail.resource.element.classList.add('missing')));\n\n})));\n"]}