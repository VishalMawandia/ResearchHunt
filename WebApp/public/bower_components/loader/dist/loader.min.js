"use strict";function _objectSpread(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{},r=Object.keys(n);"function"==typeof Object.getOwnPropertySymbols&&(r=r.concat(Object.getOwnPropertySymbols(n).filter(function(e){return Object.getOwnPropertyDescriptor(n,e).enumerable}))),r.forEach(function(t){_defineProperty(e,t,n[t])})}return e}function _defineProperty(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function _possibleConstructorReturn(e,t){return!t||"object"!==_typeof(t)&&"function"!=typeof t?_assertThisInitialized(e):t}function _assertThisInitialized(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function _inherits(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&_setPrototypeOf(e,t)}function _wrapNativeSuper(e){var t="function"==typeof Map?new Map:void 0;return(_wrapNativeSuper=function(e){if(null===e||!_isNativeFunction(e))return e;if("function"!=typeof e)throw new TypeError("Super expression must either be null or a function");if(void 0!==t){if(t.has(e))return t.get(e);t.set(e,n)}function n(){return _construct(e,arguments,_getPrototypeOf(this).constructor)}return n.prototype=Object.create(e.prototype,{constructor:{value:n,enumerable:!1,writable:!0,configurable:!0}}),_setPrototypeOf(n,e)})(e)}function isNativeReflectConstruct(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],function(){})),!0}catch(e){return!1}}function _construct(e,t,n){return(_construct=isNativeReflectConstruct()?Reflect.construct:function(e,t,n){var r=[null];r.push.apply(r,t);var o=new(Function.bind.apply(e,r));return n&&_setPrototypeOf(o,n.prototype),o}).apply(null,arguments)}function _isNativeFunction(e){return-1!==Function.toString.call(e).indexOf("[native code]")}function _setPrototypeOf(e,t){return(_setPrototypeOf=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function _getPrototypeOf(e){return(_getPrototypeOf=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function _defineProperties(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function _createClass(e,t,n){return t&&_defineProperties(e.prototype,t),n&&_defineProperties(e,n),e}function _toConsumableArray(e){return _arrayWithoutHoles(e)||_iterableToArray(e)||_nonIterableSpread()}function _nonIterableSpread(){throw new TypeError("Invalid attempt to spread non-iterable instance")}function _iterableToArray(e){if(Symbol.iterator in Object(e)||"[object Arguments]"===Object.prototype.toString.call(e))return Array.from(e)}function _arrayWithoutHoles(e){if(Array.isArray(e)){for(var t=0,n=new Array(e.length);t<e.length;t++)n[t]=e[t];return n}}function _typeof(e){return(_typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}!function(e,t){"object"===("undefined"==typeof exports?"undefined":_typeof(exports))&&"undefined"!=typeof module?module.exports=t():"function"==typeof define&&define.amd?define("Loader",t):(void 0).Loader=t()}(0,function(){var e,t={image:["jp[e]?g","jpe","jif","jfif","jfi","gif","png","tif[f]?","bmp","dib","webp","ico","cur","svg"],audio:["mp3","ogg","oga","spx","ogg","wav"],video:["mp4","ogg","ogv","webm"]},n={image:["img","picture"],audio:["audio"],video:["video"],other:["iframe"]},r=_toConsumableArray(new Set(Object.values(n).reduce(function(e,t){return e.concat(t)}))),o=";base64,",i=function(){function e(i){_classCallCheck(this,e);var s=i.element instanceof HTMLElement;this.url=i.url,this.consistent=s&&r.includes(i.element.tagName.toLowerCase()),this.element=s?i.element:null;var c=s?this.element.tagName.toLowerCase():null;if(this.type=null,this.extension=null,this.url){for(var a in this.url=i.url,new RegExp("".concat(o)).test(this.url)||(this.url=this.url.split(",").pop().split(" ").reduce(function(e,t){return e.length>t.length?e:t})),t){var u=t[a].join("|");if(new RegExp("(.(".concat(u,")$)|data:").concat(a,"/(").concat(u,")").concat(o)).test(this.url)){var l=this.url.match(new RegExp(".(".concat(u,")$"),"g"))||this.url.match(new RegExp("^data:".concat(a,"/(").concat(u,")"),"g"));if(null!==l){this.type=a,this.extension=l[0].replace("data:".concat(a,"/"),"").replace(".","");break}}}if(!this.consistent||"audio"!==c&&"video"!==c&&"iframe"!==c){if(c)for(var f in n)if(n[f].includes(c)){this.type=f;break}}else this.type=c}}return _createClass(e,null,[{key:"isResource",value:function(e){return"object"===_typeof(e)&&"type"in e&&"url"in e&&"extension"in e&&"element"in e}}]),e}(),s=function(e){function t(e){var n;return _classCallCheck(this,t),(n=_possibleConstructorReturn(this,_getPrototypeOf(t).call(this,function(t,r){e(t,r,function(e){try{return n._progress.forEach(function(t){return t(e)})}catch(e){r(e)}})})))._progress=[],n}return _inherits(t,_wrapNativeSuper(Promise)),_createClass(t,[{key:"progress",value:function(e){return"function"==typeof e&&this._progress.push(e),this}}]),t}(),c=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:document.body,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n=_objectSpread({},{srcAttributes:{src:t.lazy?"data-src":"src",srcset:t.lazy?"data-srcset":"srcset"},sizesAttributes:{sizes:t.lazy?"data-sizes":"sizes",media:t.lazy?"data-media":"media"},backgrounds:!1},t),o=[],s=r.join(","),c=Object.values(n.srcAttributes),a=c.map(function(e){return"[".concat(e,"]")}).join(","),u=_toConsumableArray(e.querySelectorAll(s)).filter(function(e){return!e.parentElement||"picture"!==e.parentElement.tagName.toLowerCase()});return!e.matches(s)||e.parentElement&&"picture"===e.parentElement.tagName.toLowerCase()||u.push(e),u.forEach(function(e){var t=e;if(e.querySelectorAll("source").length&&(t=_toConsumableArray(t=e.querySelectorAll("source"))[0]),t.matches(a)){for(var n="",r=0,s=c.length;r<s&&!(n=t.getAttribute(c[r]));r++);o.push(new i({element:e,url:n}))}}),!0===n.backgrounds&&((u=_toConsumableArray(e.querySelectorAll("*"))).push(e),(u=(u=u.filter(function(e){return!e.matches(s)})).filter(function(e){return"none"!==window.getComputedStyle(e).getPropertyValue("background-image")})).forEach(function(e){var t=window.getComputedStyle(e).getPropertyValue("background-image").match(/\((.*?)\)/);null!==t&&t.length>=2&&o.push(new i({element:e,url:t[1].replace(/('|")/g,"")}))})),o},a=function(e,t){Object.keys(t).forEach(function(n){var r=t[n];r="src"===r||"srcset"===r?"data-".concat(r):r;var o=e.getAttribute(r);o&&(e.setAttribute(n,o),e.removeAttribute(r))})},u=function(e,t,n){return n.forEach(function(n){var r=t.getAttribute(n);r&&e.setAttribute("src"===n||"srcset"===n?"data-".concat(n):n,r)})},l=function(e,t){return t.forEach(function(t){return e.removeAttribute(t)})},f=function(e){return!0},p="".concat((e=function(){return Math.floor(65536*(1+Math.random())).toString(16).substring(1)})()).concat(e(),"-").concat(e(),"-").concat(e(),"-").concat(e(),"-").concat(e()).concat(e()).concat(e()),d=function(e){for(var t=[],n=0;n<50;n++)t.push(2*n/100);return t}(),y="IntersectionObserver"in window,b=function(){if("function"==typeof window.CustomEvent)return window.CustomEvent;function e(e,t){t=t||{bubbles:!1,cancelable:!1,detail:void 0};var n=document.createEvent("CustomEvent");return n.initCustomEvent(e,t.bubbles,t.cancelable,t.detail),n}return e.prototype=window.Event.prototype,e}();return function(){function e(){var t=this,n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};if(_classCallCheck(this,e),this._options=_objectSpread({},{srcAttributes:{src:n.lazy?"data-src":"src",srcset:n.lazy?"data-srcset":"srcset"},sizesAttributes:{sizes:n.lazy?"data-sizes":"sizes",media:n.lazy?"data-media":"media"},lazy:!1,playthrough:!1,backgrounds:!0,sequential:!1},n),this._collection=[],this._queue=new Map,this._load=null,this._percentage=0,this._state=0,!y){this.manuallyObservedElements=[];var r=function(){return t.manuallyObservedElements.filter(function(e){return!e.intersected}).forEach(function(e){!e.intersected&&f(e.element)&&(e.intersected=!0,e.element.dispatchEvent(new b("intersected__".concat(p))))})};window.addEventListener("scroll",r),window.addEventListener("resize",r),window.addEventListener("load",r)}}return _createClass(e,[{key:"abort",value:function(){0!==this._state&&(this._state=0,this._queue.forEach(function(e,t){return t.dispatchEvent(new b("abort__".concat(p)))}))}},{key:"load",value:function(){var e=this;return this._load=new s(function(t,n,r){if(1===e._state&&n("This Loader instance is already in progress"),e._collection.length||n("Resources collection is empty"),e._state=1,e._options.sequential){var o=0;!function i(){if(0===e._state)return n("Loader instance aborted"),void(e._collection=[]);e.fetch(e._collection[o]).catch(function(e){return console.warn("".concat(e.event.detail.message,": ").concat(e.resource.url)),e}).then(function(n){0!==e._state&&o++,e._percentage=o/e._collection.length*100,0!==e._state&&r(n),o<e._collection.length?i():(e._state=0,t(n))})}()}else!function(){for(var o=0,i=0;i<e._collection.length;i++){if(0===e._state){n("Loader instance aborted"),e._collection=[];break}e.fetch(e._collection[i]).catch(function(e){return console.warn("".concat(e.event.detail.message,": ").concat(e.resource.url)),e}).then(function(n){0!==e._state&&o++,e._percentage=o/e._collection.length*100,0!==e._state&&r(n),o>=e._collection.length&&(e._state=0,t())})}}()}),this._load}},{key:"fetch",value:function(e){var t=this;return new Promise(function(r,o){var i=e.consistent&&document.body.contains(e.element),s=i&&e.element.querySelectorAll("source").length,c=i?e.element.tagName.toLowerCase():n[e.type][0],h=document.createElement(c),m=h;if("iframe"===e.type&&(h.style.visibility="hidden",h.style.position="fixed",h.style.top="-999px",h.style.left="-999px",h.style.width="1px",h.style.height="1px",document.body.appendChild(h)),i&&(u(h,e.element,Object.values(t._options.srcAttributes)),u(h,e.element,Object.values(t._options.sizesAttributes)),s&&_toConsumableArray(e.element.querySelectorAll("source")).forEach(function(e){var n=document.createElement("source");u(n,e,Object.values(t._options.srcAttributes)),u(n,e,Object.values(t._options.sizesAttributes)),h.append(n)}),"picture"===c)){var _=e.element.querySelector("img"),v=document.createElement("img");u(v,_,Object.values(t._options.srcAttributes)),u(v,_,Object.values(t._options.sizesAttributes)),h.append(v),m=v}var g=function(n,r){i&&(a(e.element,t._options.srcAttributes),a(e.element,t._options.sizesAttributes),s&&_toConsumableArray(e.element.querySelectorAll("source")).forEach(function(e){a(e,t._options.srcAttributes),a(e,t._options.sizesAttributes)}),"video"!==e.type&&"audio"!==e.type||e.element.load(),"iframe"===e.type&&h.parentElement.removeChild(h)),t._queue.delete(h),r({event:n,resource:e})},w=function(){i?(a(h,t._options.srcAttributes),a(h,t._options.sizesAttributes),s&&_toConsumableArray(h.querySelectorAll("source")).forEach(function(e){a(e,t._options.srcAttributes),a(e,t._options.sizesAttributes)})):h.setAttribute("src",e.url),"video"!==e.type&&"audio"!==e.type||h.load()},A=function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"",n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},r=new b(t,{detail:_objectSpread({},n,{resource:e})});return e.element&&e.element.dispatchEvent(r),document.dispatchEvent(r),r},E={resource:e,observer:null,element:h};h.addEventListener("abort__".concat(p),function(){l(h,Object.keys(t._options.srcAttributes)),l(h,Object.values(t._options.srcAttributes)),l(h,Object.keys(t._options.sizesAttributes)),l(h,Object.values(t._options.sizesAttributes)),s&&_toConsumableArray(h.querySelectorAll("source")).forEach(function(e){l(e,Object.keys(t._options.srcAttributes)),l(e,Object.values(t._options.srcAttributes)),l(e,Object.keys(t._options.sizesAttributes)),l(e,Object.values(t._options.sizesAttributes))});var e=A("resourceError",{type:"abortion",message:"Resource load aborted"});g(e,o)}),m.addEventListener("error",function(e){var t=A("resourceError",{type:e.type,message:"Resource failed to load"});g(t,o)}),"image"!==e.type&&"iframe"!==e.type||m.addEventListener("load",function(e){if("iframe"!==e.target.tagName.toLowerCase()||e.target.getAttribute("src")){var t=A("resourceLoad",{type:e.type});g(t,r)}}),"audio"!==e.type&&"video"!==e.type||m.addEventListener(t._options.playthrough?"canplaythrough":"loadedmetadata",function(e){var t=A("resourceLoad",{type:e.type});g(t,r)}),e.element instanceof HTMLElement&&t._options.lazy?(y?(E.observer=new IntersectionObserver(function(e,t){e.forEach(function(e){e.intersectionRatio>0&&(t.unobserve(e.target),w())})},{root:null,rootMargin:"0px",threshold:d}),E.observer.observe(e.element)):f(e.element)?w():(t.manuallyObservedElements.push({element:e.element,intersected:!1}),e.element.addEventListener("intersected__".concat(p),function(){return w()})),t._queue.set(e.element,E)):(t._queue.set(h,E),w())})}},{key:"percentage",get:function(){return this._percentage}},{key:"collection",set:function(e){var t=this;0===this._state&&(e instanceof NodeList&&(e=_toConsumableArray(e)),e instanceof HTMLElement&&(e=c(e,this._options)),"string"==typeof e&&(e=[new i({url:e})]),i.isResource(e)&&(e=[e]),Array.isArray(e)&&(this._collection=[],e.forEach(function(e){var n=function(e){"image"===e.type||"video"===e.type||"audio"===e.type||"iframe"===e.type&&e.consistent?t._collection.push(e):console.warn("Couldn't add resource to collection",e)};e instanceof HTMLElement&&c(e,t._options).forEach(function(e){return n(new i(e))}),"string"==typeof e&&n(new i({url:e})),i.isResource(e)&&n(e)})))},get:function(){return this._collection}}]),e}()});
//# sourceMappingURL=loader.min.js.map
