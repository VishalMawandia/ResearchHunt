{"version":3,"sources":["loader.mjs"],"names":["_objectSpread","target","i","arguments","length","source","ownKeys","Object","keys","getOwnPropertySymbols","concat","filter","sym","getOwnPropertyDescriptor","enumerable","forEach","key","_defineProperty","obj","value","defineProperty","configurable","writable","_possibleConstructorReturn","self","call","_typeof","_assertThisInitialized","ReferenceError","_inherits","subClass","superClass","TypeError","prototype","create","constructor","_setPrototypeOf","_wrapNativeSuper","Class","_cache","Map","undefined","_isNativeFunction","has","get","set","Wrapper","_construct","_getPrototypeOf","this","isNativeReflectConstruct","Reflect","construct","sham","Proxy","Date","toString","e","Parent","args","a","push","apply","instance","Function","bind","fn","indexOf","o","p","setPrototypeOf","__proto__","getPrototypeOf","_classCallCheck","Constructor","_defineProperties","props","descriptor","_createClass","protoProps","staticProps","_toConsumableArray","arr","_arrayWithoutHoles","_iterableToArray","_nonIterableSpread","iter","Symbol","iterator","Array","from","isArray","arr2","global","factory","exports","module","define","amd","Loader","s4","supportedExtensions","image","audio","video","supportedTags","other","allSupportedTags","Set","values","reduce","b","base64head","Resource","item","isElement","element","HTMLElement","url","consistent","includes","tagName","toLowerCase","type","extension","format","RegExp","test","split","pop","x","y","extensions","join","matches","match","replace","_format","LoaderPromise","_Promise","_this","resolve","reject","_progress","listener","error","Promise","handler","find","document","body","options","settings","srcAttributes","src","lazy","srcset","sizesAttributes","sizes","media","backgrounds","collection","tagsSelector","srcAttributesValues","srcAttributesSelector","map","targets","querySelectorAll","el","parentElement","attribute","j","getAttribute","window","getComputedStyle","getPropertyValue","switchAttributes","attrs","attr","dataAttr","dataAttrVal","setAttribute","removeAttribute","copyAttributes","attributes","removeAttributes","isElementInViewport","ID","Math","floor","random","substring","threshold","num","segments","isIntersectionObserverSupported","LoaderEvent","CustomEvent","event","params","bubbles","cancelable","detail","evt","createEvent","initCustomEvent","Event","_this2","_options","playthrough","sequential","_collection","_queue","_load","_percentage","_state","manuallyObservedElements","manuallyObserve","intersected","dispatchEvent","addEventListener","data","_this3","progress","loaded","pipeline","fetch","catch","payload","console","warn","message","resource","then","_this4","isConsistent","contains","hasSources","createdElement","createElement","mainEventsTarget","style","visibility","position","top","left","width","height","appendChild","createdSource","append","img","querySelector","createdImg","finishPromise","resolver","load","removeChild","delete","prepareLoad","eventName","queuer","observer","dispatchedEvent","IntersectionObserver","entries","entry","intersectionRatio","unobserve","root","rootMargin","observe","_this5","NodeList","isResource","pushCheck"],"mappings":"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","sourcesContent":["(function (global, factory) {\n    typeof exports === 'object' && typeof module !== 'undefined' ? module.exports = factory() :\n    typeof define === 'function' && define.amd ? define('Loader', factory) :\n    (global.Loader = factory());\n}(this, (function () { 'use strict';\n\n    const supportedExtensions = {\n        image: ['jp[e]?g', 'jpe', 'jif', 'jfif', 'jfi', 'gif', 'png', 'tif[f]?', 'bmp', 'dib', 'webp', 'ico', 'cur', 'svg'],\n        audio: ['mp3', 'ogg', 'oga', 'spx', 'ogg', 'wav'],\n        video: ['mp4', 'ogg', 'ogv', 'webm']\n    };\n    const supportedTags = {\n        image: ['img', 'picture'],\n        audio: ['audio'],\n        video: ['video'],\n        other: ['iframe'] // TODO: ...\n    };\n    const allSupportedTags = [...new Set(Object.values(supportedTags).reduce((a, b) => a.concat(b)))];\n\n    const base64head = ';base64,';\n\n    /**\n     * @param {Object} item\n     * @returns {Object}\n     */\n    class Resource {\n        constructor(item) {\n            const isElement = item.element instanceof HTMLElement;\n\n            this.url = item.url;\n            this.consistent = isElement && allSupportedTags.includes(item.element.tagName.toLowerCase());\n            this.element = isElement ? item.element : null;\n            const tagName = isElement ? this.element.tagName.toLowerCase() : null;\n            this.type = null;\n            this.extension = null;\n\n            if (!this.url) {\n                return;\n            }\n\n            this.url = item.url;\n\n            // this cleans urls like \"url.jpg, url.jpg x2\" ...\n            if (!new RegExp(`${base64head}`).test(this.url)) {\n                this.url = this.url\n                    .split(',')\n                    .pop() // gets the last\n                    .split(' ')\n                    .reduce((x, y) => (x.length > y.length ? x : y)); // gets the longest fragment in order to skip \"x2\", \"\" etc...\n            }\n\n            for (let format in supportedExtensions) {\n                const extensions = supportedExtensions[format].join('|');\n\n                if (new RegExp(`(.(${extensions})$)|data:${format}/(${extensions})${base64head}`).test(this.url)) {\n                    const matches = this.url.match(new RegExp(`.(${extensions})$`, 'g')) || this.url.match(new RegExp(`^data:${format}/(${extensions})`, 'g'));\n\n                    if (null !== matches) {\n                        this.type = format;\n                        this.extension = matches[0].replace(`data:${format}/`, '').replace('.', '');\n\n                        break;\n                    }\n                }\n            }\n\n            if (this.consistent && (tagName === 'audio' || tagName === 'video' || tagName === 'iframe')) {\n                this.type = tagName;\n            } else if (tagName) {\n                for (let format in supportedTags) {\n                    if (supportedTags[format].includes(tagName)) {\n                        this.type = format;\n                        break;\n                    }\n                }\n            }\n        }\n\n        static isResource(item) {\n            return typeof item === 'object' && 'type' in item && 'url' in item && 'extension' in item && 'element' in item;\n        }\n    }\n\n    /**\n     *\n     */\n    class LoaderPromise extends Promise {\n        constructor(fn) {\n            super((resolve, reject) => {\n                fn(resolve, reject, value => {\n                    try {\n                        return this._progress.forEach(listener => listener(value));\n                    } catch (error) {\n                        reject(error);\n                    }\n                });\n            });\n\n            this._progress = [];\n        }\n\n        progress(handler) {\n            if (typeof handler === 'function') {\n                this._progress.push(handler);\n            }\n\n            return this;\n        }\n    }\n\n    /**\n     *\n     * @param {HTMLElement} [element=document.body]\n     * @param {Object} [options={ srcAttr: 'src', srcsetAttr: 'srcset', backgrounds: false }]\n     * @returns {Array}\n     */\n    const find = (element = document.body, options = {}) => {\n        let settings = {\n            ...{\n                srcAttributes: {\n                    src: !!!options.lazy ? 'src' : 'data-src',\n                    srcset: !!!options.lazy ? 'srcset' : 'data-srcset'\n                },\n                sizesAttributes: {\n                    sizes: !!!options.lazy ? 'sizes' : 'data-sizes',\n                    media: !!!options.lazy ? 'media' : 'data-media'\n                },\n                backgrounds: false\n            },\n            ...options\n        };\n\n        let collection = [];\n\n        const tagsSelector = allSupportedTags.join(',');\n        const srcAttributesValues = Object.values(settings.srcAttributes);\n        const srcAttributesSelector = srcAttributesValues.map(x => `[${x}]`).join(',');\n\n        let targets = [...element.querySelectorAll(tagsSelector)].filter(el => !el.parentElement || el.parentElement.tagName.toLowerCase() !== 'picture');\n        if (element.matches(tagsSelector) && (!element.parentElement || element.parentElement.tagName.toLowerCase() !== 'picture')) {\n            targets.push(element);\n        }\n\n        targets.forEach(target => {\n            let source = target;\n\n            if (target.querySelectorAll('source').length) {\n                source = target.querySelectorAll('source');\n                source = [...source][0];\n            }\n\n            if (source.matches(srcAttributesSelector)) {\n                let attribute = '';\n\n                for (let i = 0, j = srcAttributesValues.length; i < j; i++) {\n                    attribute = source.getAttribute(srcAttributesValues[i]);\n                    if (attribute) {\n                        break;\n                    }\n                }\n\n                collection.push(\n                    new Resource({\n                        element: target,\n                        url: attribute\n                    })\n                );\n            }\n        });\n\n        if (true === settings.backgrounds) {\n            targets = [...element.querySelectorAll('*')];\n            targets.push(element);\n            targets = targets.filter(target => !target.matches(tagsSelector));\n            targets = targets.filter(target => window.getComputedStyle(target).getPropertyValue('background-image') !== 'none');\n            targets.forEach(target => {\n                const url = window.getComputedStyle(target).getPropertyValue('background-image').match(/\\((.*?)\\)/);\n\n                if (null !== url && url.length >= 2) {\n                    collection.push(\n                        new Resource({\n                            element: target,\n                            url: url[1].replace(/('|\")/g, '')\n                        })\n                    );\n                }\n            });\n        }\n\n        return collection;\n    };\n\n    /**\n     *\n     * @param {HTMLElement} el\n     * @param {Object} attrs\n     * @returns {void}\n     */\n    const switchAttributes = (el, attrs) => {\n        Object.keys(attrs).forEach(attr => {\n            let dataAttr = attrs[attr];\n            dataAttr = dataAttr === 'src' || dataAttr === 'srcset' ? `data-${dataAttr}` : dataAttr; // TODO: refactory\n            const dataAttrVal = el.getAttribute(dataAttr);\n\n            if (dataAttrVal) {\n                el.setAttribute(attr, dataAttrVal);\n                el.removeAttribute(dataAttr);\n            }\n        });\n    };\n\n    /**\n     *\n     * @param {HTMLElement} el\n     * @param {HTMLElement} attributes\n     * @returns {void}\n     */\n    const copyAttributes = (el, target, attributes) =>\n        attributes.forEach(attr => {\n            const attribute = target.getAttribute(attr);\n            if (attribute) {\n                el.setAttribute(attr === 'src' || attr === 'srcset' ? `data-${attr}` : attr, attribute); // TODO: refactory\n            }\n        });\n\n    /**\n     *\n     * @param {HTMLElement} el\n     * @param {Array} attributes\n     * @returns {void}\n     */\n    const removeAttributes = (el, attributes) => attributes.forEach(attr => el.removeAttribute(attr));\n\n    /**\n     * used in the IntersectionObserver fallback logic\n     * @param el\n     * returns {boolean}\n     */\n    const isElementInViewport = el => true;\n\n    // TODO: rename\n    const ID = (() => {\n        const s4 = () =>\n            Math.floor((1 + Math.random()) * 0x10000)\n                .toString(16)\n                .substring(1);\n        return `${s4()}${s4()}-${s4()}-${s4()}-${s4()}-${s4()}${s4()}${s4()}`;\n    })();\n\n    // TODO: rename\n    // TODO: consider exposing it in options maybe?\n    const threshold = (num => {\n        let segments = [];\n\n        for (let i = 0; i < num; i++) {\n            segments.push((2 * i) / 100);\n        }\n\n        return segments;\n    })(50);\n\n    const isIntersectionObserverSupported = 'IntersectionObserver' in window;\n\n    const LoaderEvent = (() => {\n        if (typeof window.CustomEvent === 'function') {\n            return window.CustomEvent;\n        }\n\n        function CustomEvent(event, params) {\n            params = params || {\n                bubbles: false,\n                cancelable: false,\n                detail: undefined\n            };\n\n            const evt = document.createEvent('CustomEvent');\n\n            evt.initCustomEvent(event, params.bubbles, params.cancelable, params.detail);\n\n            return evt;\n        }\n\n        CustomEvent.prototype = window.Event.prototype;\n\n        return CustomEvent;\n    })();\n\n    /**\n     *\n     * TODO: find a way to get a recap of what Resource items were loaded and what failed in collection list...\n     */\n    class Loader {\n        constructor(options = {}) {\n            this._options = {\n                ...{\n                    srcAttributes: {\n                        src: !!!options.lazy ? 'src' : 'data-src',\n                        srcset: !!!options.lazy ? 'srcset' : 'data-srcset'\n                    },\n                    sizesAttributes: {\n                        sizes: !!!options.lazy ? 'sizes' : 'data-sizes',\n                        media: !!!options.lazy ? 'media' : 'data-media'\n                    },\n                    lazy: false,\n                    playthrough: false,\n                    backgrounds: true,\n                    sequential: false\n                },\n                ...options\n            };\n\n            this._collection = []; // resources (array of type Resource)\n            this._queue = new Map(); // loading resources\n\n            this._load = null; // main load Promise\n\n            this._percentage = 0; // loading percentage\n            this._state = 0; // 0: inactive - 1: busy\n\n            if (!isIntersectionObserverSupported) {\n                this.manuallyObservedElements = [];\n\n                const manuallyObserve = () =>\n                    this.manuallyObservedElements\n                        .filter(item => !item.intersected)\n                        .forEach(item => {\n                            if (!item.intersected && isElementInViewport(item.element)) {\n                                item.intersected = true;\n                                item.element.dispatchEvent(new LoaderEvent(`intersected__${ID}`));\n                            }\n                        });\n\n                window.addEventListener('scroll', manuallyObserve);\n                window.addEventListener('resize', manuallyObserve);\n                window.addEventListener('load', manuallyObserve);\n            }\n        }\n\n        /**\n         * @returns {Number} percentage\n         */\n        get percentage() {\n            return this._percentage;\n        }\n\n        /**\n         * @param {(Array|HTMLElement)} collection\n         */\n        set collection(collection) {\n            if (this._state === 0) {\n                if (collection instanceof NodeList) {\n                    collection = [...collection];\n                }\n\n                if (collection instanceof HTMLElement) {\n                    collection = find(collection, this._options);\n                }\n\n                if (typeof collection === 'string') {\n                    collection = [new Resource({ url: collection })];\n                }\n\n                if (Resource.isResource(collection)) {\n                    collection = [collection];\n                }\n\n                if (Array.isArray(collection)) {\n                    this._collection = [];\n\n                    collection.forEach(item => {\n                        const pushCheck = resource => {\n                            if (resource.type === 'image' || resource.type === 'video' || resource.type === 'audio' || (resource.type === 'iframe' && resource.consistent)) {\n                                this._collection.push(resource);\n\n                                return;\n                            }\n\n                            console.warn(\"Couldn't add resource to collection\", resource);\n                        };\n\n                        if (item instanceof HTMLElement) {\n                            find(item, this._options).forEach(resource => pushCheck(new Resource(resource)));\n                        }\n\n                        if (typeof item === 'string') {\n                            pushCheck(new Resource({ url: item }));\n                        }\n\n                        if (Resource.isResource(item)) {\n                            pushCheck(item);\n                        }\n                    });\n                }\n            }\n        }\n\n        /**\n         *\n         * @returns {Array} collection\n         */\n        get collection() {\n            return this._collection;\n        }\n\n        /**\n         *\n         * @returns {void}\n         */\n        abort() {\n            if (this._state === 0) {\n                return;\n            }\n\n            this._state = 0;\n\n            this._queue.forEach((data, element) => element.dispatchEvent(new LoaderEvent(`abort__${ID}`)));\n        }\n\n        /**\n         *\n         * @returns {Promise}\n         */\n        load() {\n            this._load = new LoaderPromise((resolve, reject, progress) => {\n                if (this._state === 1) {\n                    reject('This Loader instance is already in progress');\n                }\n\n                if (!this._collection.length) {\n                    reject('Resources collection is empty');\n                }\n\n                this._state = 1;\n\n                if (this._options.sequential) {\n                    let loaded = 0;\n                    const pipeline = () => {\n                        if (this._state === 0) {\n                            reject('Loader instance aborted');\n\n                            this._collection = [];\n\n                            return;\n                        }\n\n                        this.fetch(this._collection[loaded])\n                            .catch(payload => {\n                                console.warn(`${payload.event.detail.message}: ${payload.resource.url}`);\n\n                                return payload;\n                            })\n                            .then(payload => {\n                                if (this._state !== 0) {\n                                    loaded++;\n                                }\n\n                                this._percentage = (loaded / this._collection.length) * 100;\n\n                                // TODO: a more robust way to skip progress call in a then from a catch, possibly inside LoaderPromise?\n                                if (this._state !== 0) {\n                                    progress(payload);\n                                }\n\n                                if (loaded < this._collection.length) {\n                                    pipeline();\n\n                                    return;\n                                }\n\n                                this._state = 0;\n\n                                resolve(payload);\n                            });\n                    };\n\n                    pipeline();\n                } else {\n                    let loaded = 0;\n\n                    for (let i = 0; i < this._collection.length; i++) {\n                        if (this._state === 0) {\n                            reject('Loader instance aborted');\n\n                            this._collection = [];\n\n                            break;\n                        }\n\n                        this.fetch(this._collection[i])\n                            .catch(payload => {\n                                console.warn(`${payload.event.detail.message}: ${payload.resource.url}`);\n\n                                return payload;\n                            })\n                            .then(payload => {\n                                if (this._state !== 0) {\n                                    loaded++;\n                                }\n\n                                this._percentage = (loaded / this._collection.length) * 100;\n\n                                // TODO: a more robust way to skip progress call in a then from a catch, possibly inside LoaderPromise?\n                                if (this._state !== 0) {\n                                    progress(payload);\n                                }\n\n                                if (loaded >= this._collection.length) {\n                                    this._state = 0;\n\n                                    resolve();\n                                }\n                            });\n                    }\n                }\n            });\n\n            return this._load;\n        }\n\n        /**\n         *\n         * @param {Resource} resource\n         * @returns {Promise}\n         */\n        fetch(resource) {\n            return new Promise((resolve, reject) => {\n                const isConsistent = resource.consistent && document.body.contains(resource.element);\n                const hasSources = isConsistent && resource.element.querySelectorAll('source').length;\n                const tagName = isConsistent ? resource.element.tagName.toLowerCase() : supportedTags[resource.type][0];\n                const createdElement = document.createElement(tagName);\n\n                let mainEventsTarget = createdElement;\n\n                if (resource.type === 'iframe') {\n                    createdElement.style.visibility = 'hidden';\n                    createdElement.style.position = 'fixed';\n                    createdElement.style.top = '-999px';\n                    createdElement.style.left = '-999px';\n                    createdElement.style.width = '1px';\n                    createdElement.style.height = '1px';\n                    document.body.appendChild(createdElement);\n                }\n\n                if (isConsistent) {\n                    copyAttributes(createdElement, resource.element, Object.values(this._options.srcAttributes));\n                    copyAttributes(createdElement, resource.element, Object.values(this._options.sizesAttributes));\n\n                    if (hasSources) {\n                        [...resource.element.querySelectorAll('source')].forEach(source => {\n                            const createdSource = document.createElement('source');\n                            copyAttributes(createdSource, source, Object.values(this._options.srcAttributes));\n                            copyAttributes(createdSource, source, Object.values(this._options.sizesAttributes));\n                            createdElement.append(createdSource);\n                        });\n                    }\n\n                    if (tagName === 'picture') {\n                        // picture elements event listeners need to be attached to inner img elements\n                        const img = resource.element.querySelector('img');\n                        const createdImg = document.createElement('img');\n                        copyAttributes(createdImg, img, Object.values(this._options.srcAttributes));\n                        copyAttributes(createdImg, img, Object.values(this._options.sizesAttributes));\n                        createdElement.append(createdImg);\n                        mainEventsTarget = createdImg;\n                    }\n                }\n\n                const finishPromise = (event, resolver) => {\n                    if (isConsistent) {\n                        switchAttributes(resource.element, this._options.srcAttributes);\n                        switchAttributes(resource.element, this._options.sizesAttributes);\n\n                        if (hasSources) {\n                            [...resource.element.querySelectorAll('source')].forEach(source => {\n                                switchAttributes(source, this._options.srcAttributes);\n                                switchAttributes(source, this._options.sizesAttributes);\n                            });\n                        }\n\n                        if (resource.type === 'video' || resource.type === 'audio') {\n                            resource.element.load();\n                        }\n\n                        if (resource.type === 'iframe') {\n                            createdElement.parentElement.removeChild(createdElement);\n                        }\n                    }\n\n                    this._queue.delete(createdElement);\n\n                    resolver({\n                        event: event,\n                        resource: resource\n                    });\n                };\n\n                const prepareLoad = () => {\n                    if (isConsistent) {\n                        switchAttributes(createdElement, this._options.srcAttributes);\n                        switchAttributes(createdElement, this._options.sizesAttributes);\n\n                        if (hasSources) {\n                            [...createdElement.querySelectorAll('source')].forEach(source => {\n                                switchAttributes(source, this._options.srcAttributes);\n                                switchAttributes(source, this._options.sizesAttributes);\n                            });\n                        }\n                    } else {\n                        createdElement.setAttribute('src', resource.url);\n                    }\n\n                    if (resource.type === 'video' || resource.type === 'audio') {\n                        createdElement.load();\n                    }\n                };\n\n                const dispatchEvent = (eventName = '', data = {}) => {\n                    const event = new LoaderEvent(eventName, {\n                        detail: {\n                            ...data,\n                            ...{\n                                resource: resource\n                            }\n                        }\n                    });\n\n                    if (resource.element) {\n                        resource.element.dispatchEvent(event);\n                    }\n\n                    document.dispatchEvent(event);\n\n                    return event;\n                };\n\n                let queuer = {\n                    resource: resource,\n                    observer: null,\n                    element: createdElement\n                };\n\n                createdElement.addEventListener(`abort__${ID}`, () => {\n                    removeAttributes(createdElement, Object.keys(this._options.srcAttributes));\n                    removeAttributes(createdElement, Object.values(this._options.srcAttributes));\n                    removeAttributes(createdElement, Object.keys(this._options.sizesAttributes));\n                    removeAttributes(createdElement, Object.values(this._options.sizesAttributes));\n\n                    if (hasSources) {\n                        [...createdElement.querySelectorAll('source')].forEach(source => {\n                            removeAttributes(source, Object.keys(this._options.srcAttributes));\n                            removeAttributes(source, Object.values(this._options.srcAttributes));\n                            removeAttributes(source, Object.keys(this._options.sizesAttributes));\n                            removeAttributes(source, Object.values(this._options.sizesAttributes));\n                        });\n                    }\n\n                    const dispatchedEvent = dispatchEvent('resourceError', { type: 'abortion', message: 'Resource load aborted' });\n\n                    finishPromise(dispatchedEvent, reject);\n                });\n\n                mainEventsTarget.addEventListener('error', e => {\n                    const dispatchedEvent = dispatchEvent('resourceError', {\n                        type: e.type,\n                        message: 'Resource failed to load' // TODO: a way to retrieve http error code ?\n                    });\n\n                    finishPromise(dispatchedEvent, reject);\n                });\n\n                if (resource.type === 'image' || resource.type === 'iframe') {\n                    mainEventsTarget.addEventListener('load', e => {\n                        if (e.target.tagName.toLowerCase() === 'iframe' && !e.target.getAttribute('src')) {\n                            return; // iframes fire \"load\" event when ready in dom\n                        }\n\n                        const dispatchedEvent = dispatchEvent('resourceLoad', {\n                            type: e.type\n                        });\n\n                        finishPromise(dispatchedEvent, resolve);\n                    });\n                }\n\n                if (resource.type === 'audio' || resource.type === 'video') {\n                    mainEventsTarget.addEventListener(this._options.playthrough ? 'canplaythrough' : 'loadedmetadata', e => {\n                        const dispatchedEvent = dispatchEvent('resourceLoad', {\n                            type: e.type\n                        });\n\n                        finishPromise(dispatchedEvent, resolve);\n                    });\n                }\n\n                if (resource.element instanceof HTMLElement && this._options.lazy) {\n                    if (isIntersectionObserverSupported) {\n                        queuer.observer = new IntersectionObserver(\n                            (entries, observer) => {\n                                entries.forEach(entry => {\n                                    if (entry.intersectionRatio > 0) {\n                                        observer.unobserve(entry.target);\n\n                                        prepareLoad();\n                                    }\n                                });\n                            },\n                            {\n                                root: null,\n                                rootMargin: '0px',\n                                threshold: threshold\n                            }\n                        );\n\n                        queuer.observer.observe(resource.element);\n                    } else {\n                        if (isElementInViewport(resource.element)) {\n                            prepareLoad();\n                        } else {\n                            this.manuallyObservedElements.push({\n                                element: resource.element,\n                                intersected: false\n                            });\n\n                            resource.element.addEventListener(`intersected__${ID}`, () => prepareLoad());\n                        }\n                    }\n\n                    this._queue.set(resource.element, queuer);\n                } else {\n                    this._queue.set(createdElement, queuer);\n\n                    prepareLoad();\n                }\n            });\n        }\n    }\n\n    return Loader;\n\n})));\n"],"file":"loader.min.js"}